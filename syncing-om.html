<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Syncing Om with Sente | RP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.2/build/pure-min.css" integrity="sha384-UQiGfs9ICog+LwheBSRCt1o5cbyKIHbwjWscjemyBMT9YCUMZffs6UqUTd0hObXD" crossorigin="anonymous"/>
    <link href="https://fonts.googleapis.com/css?family=PT+Mono|PT+Sans|PT+Serif" rel="stylesheet"/>
    <link href="/index.css" rel="stylesheet"/>
</head>

<body>
    <div class="content"><h1 class="topic">Syncing Om with Sente</h1><div class="date margin">2014-05-20</div><main><p>As for now I’m using very simple optimistic syncing strategy for my <a href="https://github.com/swannodette/om">Om</a> applications. Brilliant <a href="https://github.com/ptaoussanis/sente">Sente</a> library makes this possible.</p><p>Server-side setup looks like:</p><p><script src="https://gist.github.com/ul/c6aa280cc990acf423de.js"></script></p><p>Client side:</p><p><script src="https://gist.github.com/ul/2064977d1a64fdefb398.js"></script></p><p>Now, let’s send patch on every state update. Because it may come from <span class="code" decode="exclude">om/transact!</span> and some external <span class="code" decode="exclude">swap!</span> we use <span class="code" decode="exclude">:tx-listen</span> and <span class="code" decode="exclude">add-watch</span>:</p><p><script src="https://gist.github.com/ul/068900c9cf733f8db400.js"></script></p><p><span class="code" decode="exclude">send-patch!</span> is very simple—it takes difference of old and new state and send it to server:</p><p><script src="https://gist.github.com/ul/7bebfa3406a0e8417f58.js"></script></p><p>And let’s update our state on patch arrival from server:</p><p><script src="https://gist.github.com/ul/60a34923a0be781e37a0.js"></script></p><p>Voilà! I will skip <span class="code" decode="exclude">retract</span>, <span class="code" decode="exclude">deep-merge</span> and server side patch-listening implementations, they are rather trivial.</p><p>This strategy gives us simple state sync management. Just for fun, if we want to unapply patch <span class="code" decode="exclude">[d- d+]</span> sent from client, we could send <span class="code" decode="exclude">[d+ d-]</span> back and it is done!</p></main></div>
    <div class="nav"><a class="box-link" href="automating-refactor.html"><div>&larr;</div><div>Automating Clojure refactor with rewrite-clj</div></a>
<a class="box-link" href="archive.html"><div>&uarr;</div><div>Archive</div></a>
</div>
</body>

</html>